<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-179962442-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-179962442-1",{anonymize_ip:!0})</script><title data-react-helmet="true">GCP Getting Started from an example | GruCloud</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://grucloud.github.io//docs/google/GoogleGettingStartedExample"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="GCP Getting Started from an example | GruCloud"><meta data-react-helmet="true" name="description" content="Objective"><meta data-react-helmet="true" property="og:description" content="Objective"><link data-react-helmet="true" rel="shortcut icon" href="/img/cloud.svg"><link data-react-helmet="true" rel="canonical" href="https://grucloud.github.io//docs/google/GoogleGettingStartedExample"><link data-react-helmet="true" rel="alternate" href="https://grucloud.github.io//docs/google/GoogleGettingStartedExample" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://grucloud.github.io//docs/google/GoogleGettingStartedExample" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.8f7d6cb1.css">
<link rel="preload" href="/assets/js/runtime~main.b7350002.js" as="script">
<link rel="preload" href="/assets/js/main.78c43231.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/cloud.svg" alt="GruCloud Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/cloud.svg" alt="GruCloud Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">GruCloud</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/grucloud/grucloud" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><main class="docMainContainer_r8cw docMainContainerEnhanced_SOUu"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>GCP Getting Started from an example</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="objective">Objective<a aria-hidden="true" class="hash-link" href="#objective" title="Direct link to heading">​</a></h2><p>Let&#x27;s automate the deployment of a virtual machine on GCP, the Google Cloud Platform.</p><p>This basic infrastructure is going to be described and configured in Javascript with the GruCloud GCP provider, distributed as the NPM package <a href="https://www.npmjs.com/package/@grucloud/provider-google" target="_blank" rel="noopener noreferrer">@grucloud/provider-google</a></p><p>This diagram represents the target resources that will be deployed:</p><p><img src="https://raw.githubusercontent.com/grucloud/grucloud/main/examples/google/vm-simple/artifacts/diagram-target.svg" alt="graph-target-gpc-vm"></p><blockquote><p>The diagram is generated with <code>gc graph</code></p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="requirements">Requirements<a aria-hidden="true" class="hash-link" href="#requirements" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="gcp-account">GCP Account<a aria-hidden="true" class="hash-link" href="#gcp-account" title="Direct link to heading">​</a></h3><p>Access to the <a href="https://console.cloud.google.com/home/dashboard" target="_blank" rel="noopener noreferrer">GCP console</a> is required to run this tutorial.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="gcloud">gcloud<a aria-hidden="true" class="hash-link" href="#gcloud" title="Direct link to heading">​</a></h3><p>Ensure the GCP CLI called <a href="https://cloud.google.com/sdk/docs/install" target="_blank" rel="noopener noreferrer">gcloud</a> is installed:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ gcloud -v</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Google Cloud SDK 318.0.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">beta 2020.11.06</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bq 2.0.62</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">core 2020.11.06</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gsutil 4.54</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="initialise-gcloud">Initialise gcloud<a aria-hidden="true" class="hash-link" href="#initialise-gcloud" title="Direct link to heading">​</a></h3><p>Initialize <em>gcloud</em> in order to authenticate your user, as well and setting the default region and zone:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud init</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Check the config at any time with:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud config list</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ssh-keys">SSH keys<a aria-hidden="true" class="hash-link" href="#ssh-keys" title="Direct link to heading">​</a></h3><p>The section describes how to manage SSH keys to access the virtual machine.</p><p>First of all, let&#x27;s list the SSH keys that may have been already created:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud compute os-login ssh-keys list</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Describe a specific key with:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud compute os-login ssh-keys describe --key=ad1811081881c04dad627f96b5d20ddd41fd44e31e76fc259c3e2534f75a190b</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Let&#x27;s create a new SSH key pair for this project and call it for instance <code>gcp-vm_rsa</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-keygen -t rsa</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Upload your ssh keys:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud compute os-login ssh-keys add --key-file gcp-vm_rsa.pub</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="nodejs">Node.js<a aria-hidden="true" class="hash-link" href="#nodejs" title="Direct link to heading">​</a></h3><p>GruCloud is written in Javascript running on <a href="https://nodejs.org" target="_blank" rel="noopener noreferrer">Node.js</a></p><p>Verify the presence of <em>node</em> and check the version:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">node --version</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Any version above 14 should be fine.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="grucloud-cli">GruCloud CLI<a aria-hidden="true" class="hash-link" href="#grucloud-cli" title="Direct link to heading">​</a></h3><p>The GruCloud CLI called <code>gc</code> can be installed globally with NPM:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm i -g @grucloud/core</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As a sanity check, display the version with:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc --version</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>That&#x27;s all for these requirements.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="code-architecture">Code Architecture<a aria-hidden="true" class="hash-link" href="#code-architecture" title="Direct link to heading">​</a></h2><p>The infrastructure will be configured and described as Javascript code, defined in the following file</p><ul><li><a href="https://github.com/grucloud/grucloud/blob/main/examples/google/vm-simple/package.json" target="_blank" rel="noopener noreferrer">package.json</a>: contains the project dependencies.</li><li><a href="https://github.com/grucloud/grucloud/blob/main/examples/google/vm-simple/config.js" target="_blank" rel="noopener noreferrer">config.js</a>: the configuration function.</li><li><a href="https://github.com/grucloud/grucloud/blob/main/examples/google/vm-simple/resources.js" target="_blank" rel="noopener noreferrer">resources.js</a>: the infrastructure as (generated) code</li><li><a href="https://github.com/grucloud/grucloud/blob/main/examples/google/vm-simple/iac.js" target="_blank" rel="noopener noreferrer">iac.js</a>: creates a google provider.</li><li><a href="https://github.com/grucloud/grucloud/blob/main/examples/google/vm-simple/hook.js" target="_blank" rel="noopener noreferrer">hook.js</a>: user defined function executed after deployment or destruction.</li></ul><p>The next sections show how to create a new project from scratch.</p><blockquote><p>FYI, the <a href="https://github.com/grucloud/grucloud/blob/main/examples/google/vm-simple" target="_blank" rel="noopener noreferrer">source code</a> for this example.</p></blockquote><p>First of all, create a new folder called for instance <code>vm-simple</code> and <code>cd</code> to it.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir vm-simple</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd vm-simple</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="packagejson">package.json<a aria-hidden="true" class="hash-link" href="#packagejson" title="Direct link to heading">​</a></h3><p>The <em>package.json</em> file is usually created with:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm init</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The project depends on libraries distributed on NPM. For this example targeting GCP, install <a href="https://www.npmjs.com/package/@grucloud/provider-google" target="_blank" rel="noopener noreferrer">@grucloud/provider-google</a> and <code>@grucloud/core</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm install @grucloud/core @grucloud/provider-google</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configjs">config.js<a aria-hidden="true" class="hash-link" href="#configjs" title="Direct link to heading">​</a></h3><p>The configuration is defined in <a href="https://github.com/grucloud/grucloud/blob/main/examples/google/vm-simple/config.js" target="_blank" rel="noopener noreferrer">config.js</a></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// config.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> stage </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  projectId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;vm-tuto1-must-be-globally-unique&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  vm</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;web-server&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    properties</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      diskSizeGb</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;20&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      machineType</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;f1-micro&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      sourceImage</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;projects/ubuntu-os-cloud/global/images/family/ubuntu-2004-lts&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      metadata</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        items</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            key</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;enable-oslogin&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            value</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;True&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="project-name-and-id">Project Name and Id<a aria-hidden="true" class="hash-link" href="#project-name-and-id" title="Direct link to heading">​</a></h4><p>Set the <code>projectId</code> and eventually ther <code>projectName</code>.</p><p>GruCloud will take care of creating the project if necessary.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="stage">stage<a aria-hidden="true" class="hash-link" href="#stage" title="Direct link to heading">​</a></h4><p>The <code>stage</code> parameter by default is <code>dev</code>. It could be any value such as <code>production</code>, <code>uat</code>, or any other stages of your deployment.</p><p>Notice how the <code>projectName</code> could be prefixed or suffixed with stage. Or the <code>machineType</code> could be a function of the <code>stage</code>, hence allowing to use cheaper machines for a specific stage.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="machine-name">Machine name<a aria-hidden="true" class="hash-link" href="#machine-name" title="Direct link to heading">​</a></h4><p>Feel free to choose a machine name, in this case <em>web-server</em>. Right now it is a static string but could be a function of the stage, or some function could be applied to enforce a style: camelCase, snake-case, PascalCase, or whatever what the requirements are.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="machinetype">machineType<a aria-hidden="true" class="hash-link" href="#machinetype" title="Direct link to heading">​</a></h4><p>The list of available <em>machineType</em> for a given region is just a command away:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud compute machine-types list --filter=&quot;zone:( southamerica-east1 )&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Choosing the right type of machine for your workload is out of scope for this tutorial.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="sourceimage">sourceImage<a aria-hidden="true" class="hash-link" href="#sourceimage" title="Direct link to heading">​</a></h4><p>The Operating System to boot on the machine is set with the <code>sourceImage</code> field.
How to find out the value of this field ? Start list the available images:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud compute images list</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The list is long so only the first lines are displayed.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                                  PROJECT              FAMILY                            DEPRECATED  STATUS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">centos-7-v20210420                                    centos-cloud         centos-7                                      READY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">centos-8-v20210420                                    centos-cloud         centos-8                                      READY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ubuntu-2004-focal-v20210429                           ubuntu-os-cloud      ubuntu-2004-lts                               READY</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The current value for <code>sourceImage</code> is <code>projects/ubuntu-os-cloud/global/images/family/ubuntu-2004-lts</code>.
Hence, to use the lastest <em>centos</em>, the sourceImage should be: <code>projects/centos-cloud/global/images/family/centos-8</code>, isn&#x27;it ?</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="enable-oslogin">enable-oslogin<a aria-hidden="true" class="hash-link" href="#enable-oslogin" title="Direct link to heading">​</a></h4><p>The <code>enable-oslogin</code> key in the <code>metadata</code> section tells GCP that the machine will be accesible though a method called <a href="https://cloud.google.com/compute/docs/instances/managing-instance-access" target="_blank" rel="noopener noreferrer">OS Login</a>. It is an alternative way of provisioning SSH access to your machine, without worrying about SSH keys sitting on your local computer that could vanished any time.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="iacjs">iac.js<a aria-hidden="true" class="hash-link" href="#iacjs" title="Direct link to heading">​</a></h3><p>Now it is time to create the infrastructure <strong>iac.js</strong> file that describes the architecture:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// iac.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">GoogleProvider</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@grucloud/provider-google&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">createResources</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> provider </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> config </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> server </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">compute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">makeVmInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">properties</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">properties</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">createStack</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> createProvider </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> provider </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">GoogleProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    createResources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./config&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This file must export the <code>createStack</code> at least, this function instantiate the provider, in this case the <code>GoogleProvider</code>.
The helper function <code>createResources</code> creates the resources for this provider and return an object with the resources created.
The last part is to return an object from <code>createStack</code> containing the provider and the resources created from this provider.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="initialisation">Initialisation<a aria-hidden="true" class="hash-link" href="#initialisation" title="Direct link to heading">​</a></h2><p>A few actions need to be performed prior to deploying the resources.</p><ul><li>Create the project</li><li>Setup billing for that project</li><li>Enable the API services</li><li>Create a service account</li><li>Create and save the credential file for this service account</li><li>Update the IAM policy by binding roles to the service account</li></ul><p>Don&#x27;t worry, these preparations steps are fully automated:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc init</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>What to expect now? The next sections explains how to use some <em>gcloud</em> command to verify what has been created during the <em>init</em> command.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="project">Project<a aria-hidden="true" class="hash-link" href="#project" title="Direct link to heading">​</a></h3><p>In the GCP world, resources are grouped into a <a href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" target="_blank" rel="noopener noreferrer">project</a>, which are defined by <code>projectName</code> and <code>projectId</code> in the config file.</p><p>Let&#x27;s verify the project has been created:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud projects list</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">PROJECT_ID                      NAME                   PROJECT_NUMBER</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vm-tuto                         vm-tuto                623960601462</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Perfect, the project has been created automatically based on our config.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="api-services">API Services<a aria-hidden="true" class="hash-link" href="#api-services" title="Direct link to heading">​</a></h3><p>The <code>init</code> command takes care of enabling the minimum set of API services:</p><ul><li>cloudbilling.googleapis.com</li><li>cloudresourcemanager.googleapis.com</li><li>iam.googleapis.com</li><li>serviceusage.googleapis.com</li></ul><p>Let&#x27;s check all the services in the <em>enabled</em> state:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud services list --enabled</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                 TITLE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bigquery.googleapis.com              BigQuery API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bigquerystorage.googleapis.com       BigQuery Storage API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cloudbilling.googleapis.com          Cloud Billing API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">clouddebugger.googleapis.com         Cloud Debugger API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cloudresourcemanager.googleapis.com  Cloud Resource Manager API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cloudtrace.googleapis.com            Cloud Trace API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">compute.googleapis.com               Compute Engine API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">datastore.googleapis.com             Cloud Datastore API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dns.googleapis.com                   Cloud DNS API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">domains.googleapis.com               Cloud Domains API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">iam.googleapis.com                   Identity and Access Management (IAM) API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">iamcredentials.googleapis.com        IAM Service Account Credentials API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">logging.googleapis.com               Cloud Logging API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">monitoring.googleapis.com            Cloud Monitoring API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">networkmanagement.googleapis.com     Network Management API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">oslogin.googleapis.com               Cloud OS Login API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">servicemanagement.googleapis.com     Service Management API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">serviceusage.googleapis.com          Service Usage API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sql-component.googleapis.com         Cloud SQL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">storage-api.googleapis.com           Google Cloud Storage JSON API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">storage-component.googleapis.com     Cloud Storage</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">storage.googleapis.com               Cloud Storage API</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="service-account">Service Account<a aria-hidden="true" class="hash-link" href="#service-account" title="Direct link to heading">​</a></h3><p>A service account called in the form of <code>grucloud@YouProjecId.iam.gserviceaccount.com</code> is created and will be used by GruCloud to talk to the GCP API.</p><p>Let&#x27;s retrieve the list of service accounts:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud iam service-accounts list</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DISPLAY NAME              EMAIL                                                    DISABLED</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">grucloud service account  grucloud@grucloud-test.iam.gserviceaccount.com            False</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Bingo, the service account has been created successfully.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="roles-binding">Roles Binding<a aria-hidden="true" class="hash-link" href="#roles-binding" title="Direct link to heading">​</a></h3><p>Next, the operation is to bind the following roles to the service account <code>grucloud@vm-tuto1.iam.gserviceaccount.com</code></p><ul><li>iam.serviceAccountAdmin</li><li>compute.admin</li><li>storage.admin</li><li>storage.objectAdmin</li><li>dns.admin</li><li>editor</li><li>resourcemanager.projectIamAdmin</li></ul><p>Ensure the correct roles are bound to the right service account for a given project, here <code>vm-tuto1</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud projects get-iam-policy  vm-tuto1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">bindings:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- members:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - serviceAccount:grucloud@vm-tuto1.iam.gserviceaccount.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  role: roles/compute.admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- members:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - serviceAccount:service-571739547473@compute-system.iam.gserviceaccount.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  role: roles/compute.serviceAgent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- members:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - serviceAccount:grucloud@vm-tuto1.iam.gserviceaccount.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  role: roles/dns.admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- members:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - serviceAccount:571739547473-compute@developer.gserviceaccount.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - serviceAccount:571739547473@cloudservices.gserviceaccount.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - serviceAccount:grucloud@vm-tuto1.iam.gserviceaccount.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  role: roles/editor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- members:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - serviceAccount:grucloud@vm-tuto1.iam.gserviceaccount.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  role: roles/iam.serviceAccountAdmin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- members:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - user:frederic.heem@gmail.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  role: roles/owner</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- members:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - serviceAccount:grucloud@vm-tuto1.iam.gserviceaccount.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  role: roles/resourcemanager.projectIamAdmin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- members:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - serviceAccount:grucloud@vm-tuto1.iam.gserviceaccount.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  role: roles/storage.admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- members:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - serviceAccount:grucloud@vm-tuto1.iam.gserviceaccount.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  role: roles/storage.objectAdmin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">etag: BwXBNb1KkZg=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">version: 1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As expected, the roles are bounded to our service account.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="credential-file">Credential file<a aria-hidden="true" class="hash-link" href="#credential-file" title="Direct link to heading">​</a></h3><p>A credential file is generated and will be stored at <code>/Users/yourusername/.config/gcloud/YourProjectId.json</code></p><p>For your information, here what it looks like:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;type&quot;: &quot;service_account&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;project_id&quot;: &quot;vm-tuto1&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;private_key_id&quot;: &quot;112233445566aabb00d4e4071478a7ca74c&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;private_key&quot;: &quot;-----BEGIN PRIVATE KEY-----\nTHE PRIVATE KEY HERE\n-----END PRIVATE KEY-----\n&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;client_email&quot;: &quot;grucloud@vm-tuto1.iam.gserviceaccount.com&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;client_id&quot;: &quot;123456789858242482&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;auth_uri&quot;: &quot;https://accounts.google.com/o/oauth2/auth&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;token_uri&quot;: &quot;https://oauth2.googleapis.com/token&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;auth_provider_x509_cert_url&quot;: &quot;https://www.googleapis.com/oauth2/v1/certs&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;client_x509_cert_url&quot;: &quot;https://www.googleapis.com/robot/v1/metadata/x509/grucloud%40vm-tuto1.iam.gserviceaccount.com&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Ensure to protect the content of this file as it contains sensitive information such as the private key to access the GCP account, and can potentially deploy some costly resources.</p><p><strong>gc</strong> requires this credential file to connect to the GCP API.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="info">Info<a aria-hidden="true" class="hash-link" href="#info" title="Direct link to heading">​</a></h3><p>The <code>info</code> provides useful information about the project and its configuration:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc info</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - provider:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      name: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      type: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    projectId: vm-tuto1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    projectName: vm-tuto1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    applicationCredentialsFile: /Users/yourusername/.config/gcloud/vm-tuto1.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    serviceAccountName: grucloud</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hasGCloud: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      vm:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name: web-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        properties:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          diskSizeGb: 20</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          machineType: f1-micro</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          sourceImage: projects/ubuntu-os-cloud/global/images/family/ubuntu-2004-lts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            items:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              - key: enable-oslogin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                value: True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      managedByTag: -managed-by-gru</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      managedByKey: managed-by</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      managedByValue: grucloud</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      region: southamerica-east1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      zone: southamerica-east1-b</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc info&quot; executed in 1s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>At this stage, the system is ready for deployment.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="cli-workflow">CLI Workflow<a aria-hidden="true" class="hash-link" href="#cli-workflow" title="Direct link to heading">​</a></h2><p>The infrastructure can be managed with a bunch of commands:</p><ul><li><code>gc plan</code></li><li><code>gc apply</code></li><li><code>gc list</code></li><li><code>gc destroy</code></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="plan">Plan<a aria-hidden="true" class="hash-link" href="#plan" title="Direct link to heading">​</a></h3><p>Find out which resources are going to be created, modified or destroyed with the <a href="https://www.grucloud.com/docs/cli/PlanQuery" target="_blank" rel="noopener noreferrer">plan</a> command.
No change wuill be made, it is an informative command which queries the GCP API for all the supported resources, compare these lives resources with the resources that shoudl be deployed, as defined in the code.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc plan</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Querying resources on 1 provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✓ google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Listing 6/6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Querying</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ VmInstance 1/1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ 1 VmInstance from google                                                                     │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ ┌─────────────────────────────────────────────────────────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ CREATE: web-server                                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ ├─────────────────────────────────────────────────────────────────────────────────────────┤  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ kind: compute#instance                                                                  │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ name: web-server                                                                        │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ zone: https://www.googleapis.com/compute/v1/projects/vm-tuto1/zones/southamerica-east1… │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ machineType: https://www.googleapis.com/compute/v1/projects/vm-tuto1/zones/southameric… │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ labels:                                                                                 │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   managed-by: grucloud                                                                  │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   stage: dev                                                                            │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ metadata:                                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   items:                                                                                │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     - key: enable-oslogin                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       value: True                                                                       │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   kind: compute#metadata                                                                │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ disks:                                                                                  │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   - kind: compute#attachedDisk                                                          │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     type: PERSISTENT                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     boot: true                                                                          │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     mode: READ_WRITE                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     autoDelete: true                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     deviceName: web-server-managed-by-gru                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     initializeParams:                                                                   │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       sourceImage: projects/ubuntu-os-cloud/global/images/family/ubuntu-2004-lts        │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       diskType: projects/vm-tuto1/zones/southamerica-east1-b/diskTypes/pd-standard      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       diskSizeGb: 20                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     diskEncryptionKey:                                                                  │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ networkInterfaces:                                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   - kind: compute#networkInterface                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     subnetwork: projects/vm-tuto1/regions/southamerica-east1/subnetworks/default        │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     accessConfigs:                                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       - kind: compute#accessConfig                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │         name: External NAT                                                              │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │         type: ONE_TO_ONE_NAT                                                            │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │         networkTier: PREMIUM                                                            │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     aliasIpRanges: []                                                                   │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ displayDevice:                                                                          │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   enableDisplay: false                                                                  │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ canIpForward: false                                                                     │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ scheduling:                                                                             │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   preemptible: false                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   onHostMaintenance: MIGRATE                                                            │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   automaticRestart: true                                                                │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   nodeAffinities: []                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ deletionProtection: false                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ reservationAffinity:                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   consumeReservationType: ANY_RESERVATION                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ shieldedInstanceConfig:                                                                 │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   enableSecureBoot: false                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   enableVtpm: true                                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   enableIntegrityMonitoring: true                                                       │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ confidentialInstanceConfig:                                                             │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   enableConfidentialCompute: false                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │                                                                                         │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ └─────────────────────────────────────────────────────────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└──────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌───────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ Plan summary for provider google                                                      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ DEPLOY RESOURCES                                                                      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬──────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ VmInstance         │ web-server                                                       │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴──────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 resource to deploy on 1 provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc plan&quot; executed in 6s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Have the opportunity to review the change that will be applied next.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="deploy">Deploy<a aria-hidden="true" class="hash-link" href="#deploy" title="Direct link to heading">​</a></h3><p>Happy with the expected plan? Deploy it now with the <a href="https://www.grucloud.com/docs/cli/PlanApply" target="_blank" rel="noopener noreferrer">apply</a> command:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc apply</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Querying resources on 1 provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✓ google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Listing 6/6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Querying</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ VmInstance 1/1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌───────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ Plan summary for provider google                                                      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ DEPLOY RESOURCES                                                                      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬──────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ VmInstance         │ web-server                                                       │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴──────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Deploying resources on 1 provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✓ google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Deploying</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ VmInstance 1/1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 resource deployed of 1 type and 1 provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running OnDeployedGlobal resources on 1 provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc a -f&quot; executed in 29s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Congratulations! Your first cloud resource deployed automativally with GruCloud.</p><p>As always, trust but verify, the newly created server should be accessible through SSH:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud compute ssh web-server --project vm-tuto1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Mission accomplished! The server is installed, up and running.</p><p>Triple check the instance is running on the <a href="https://console.cloud.google.com/compute/instances" target="_blank" rel="noopener noreferrer">gcp compute console</a></p><p>Not convinced ? Try with <em>gcloud</em>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud compute instances list --project vm-tuto1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME        ZONE                  MACHINE_TYPE  PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP   STATUS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">web-server  southamerica-east1-b  f1-micro                   10.158.0.4   35.198.52.62  RUNNING</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Does the machine responds our ping request ?</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ping 35.198.52.62</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">PING 35.198.52.62 (35.198.52.62): 56 data bytes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">64 bytes from 35.198.52.62: icmp_seq=0 ttl=59 time=176.973 ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">64 bytes from 35.198.52.62: icmp_seq=1 ttl=59 time=180.442 ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">64 bytes from 35.198.52.62: icmp_seq=2 ttl=59 time=183.338 ms</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>No firewall is blocking our ping request.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="list">List<a aria-hidden="true" class="hash-link" href="#list" title="Direct link to heading">​</a></h3><p>The command queries the GCP API and lists the available resources. It gives an overall view of the resources under the current project.</p><p>The <code>--graph</code> options generate a diagram of the live resources, showing their dependencies.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc list --graph</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[...TRUNCATED]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">List Summary:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌───────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ google                                                                │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬──────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ Network            │ default                                          │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼──────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ Firewall           │ default-allow-icmp                               │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                    │ default-allow-internal                           │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                    │ default-allow-rdp                                │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                    │ default-allow-ssh                                │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼──────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ SubNetwork         │ default                                          │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼──────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ ServiceAccount     │ 571739547473-compute                             │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                    │ grucloud                                         │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼──────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ VmInstance         │ web-server                                       │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴──────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">9 resources, 5 types, 1 provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc l&quot; executed in 12s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><img src="https://raw.githubusercontent.com/grucloud/grucloud/main/examples/google/vm-simple/artifacts/diagram-live.svg" alt="graph-live-gcp-vm"></p><p>Notice the default <code>Network</code>, <code>Subnet</code>, and 4 <code>Firewall</code> rules.</p><p>There are many options to the <em>list command</em>, for instance, list only the resources created by GruCloud</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc list --our</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Would you like to display only the virtual machines?</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc l -t VmInstance</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Listing resources on 1 provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✓ google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Listing 6/6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ 1 VmInstance from google                                                                                            │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────┬──────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ Name       │ Data                                                                                            │ Our  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────┼──────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ web-server │ id: 8015745025887516797                                                                         │ Yes  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ creationTimestamp: 2021-04-30T15:37:06.858-07:00                                                │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ name: web-server                                                                                │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ tags:                                                                                           │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   fingerprint: 42WmSpB8rSM=                                                                     │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ machineType: https://www.googleapis.com/compute/v1/projects/vm-tuto1/zones/southamerica-east1-… │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ status: RUNNING                                                                                 │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ zone: https://www.googleapis.com/compute/v1/projects/vm-tuto1/zones/southamerica-east1-b        │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ canIpForward: false                                                                             │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ networkInterfaces:                                                                              │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   - network: https://www.googleapis.com/compute/v1/projects/vm-tuto1/global/networks/default    │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     subnetwork: https://www.googleapis.com/compute/v1/projects/vm-tuto1/regions/southamerica-e… │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     networkIP: 10.158.0.4                                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     name: nic0                                                                                  │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     accessConfigs:                                                                              │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │       - type: ONE_TO_ONE_NAT                                                                    │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │         name: External NAT                                                                      │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │         natIP: 35.198.52.62                                                                     │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │         networkTier: PREMIUM                                                                    │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │         kind: compute#accessConfig                                                              │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     fingerprint: vFCpWqyPPis=                                                                   │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     kind: compute#networkInterface                                                              │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ disks:                                                                                          │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   - type: PERSISTENT                                                                            │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     mode: READ_WRITE                                                                            │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     source: https://www.googleapis.com/compute/v1/projects/vm-tuto1/zones/southamerica-east1-b… │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     deviceName: web-server-managed-by-gru                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     index: 0                                                                                    │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     boot: true                                                                                  │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     autoDelete: true                                                                            │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     licenses:                                                                                   │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │       - &quot;https://www.googleapis.com/compute/v1/projects/ubuntu-os-cloud/global/licenses/ubuntu… │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     interface: SCSI                                                                             │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     guestOsFeatures:                                                                            │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │       - type: VIRTIO_SCSI_MULTIQUEUE                                                            │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │       - type: SEV_CAPABLE                                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │       - type: UEFI_COMPATIBLE                                                                   │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     diskSizeGb: 20                                                                              │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     kind: compute#attachedDisk                                                                  │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ metadata:                                                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   fingerprint: xJ9rqloLGTU=                                                                     │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   items:                                                                                        │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │     - key: enable-oslogin                                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │       value: True                                                                               │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   kind: compute#metadata                                                                        │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ selfLink: https://www.googleapis.com/compute/v1/projects/vm-tuto1/zones/southamerica-east1-b/i… │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ scheduling:                                                                                     │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   onHostMaintenance: MIGRATE                                                                    │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   automaticRestart: true                                                                        │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   preemptible: false                                                                            │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ cpuPlatform: Intel Broadwell                                                                    │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ labels:                                                                                         │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   managed-by: grucloud                                                                          │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   stage: dev                                                                                    │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ labelFingerprint: 2XCNew8FA10=                                                                  │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ startRestricted: false                                                                          │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ deletionProtection: false                                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ reservationAffinity:                                                                            │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   consumeReservationType: ANY_RESERVATION                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ displayDevice:                                                                                  │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   enableDisplay: false                                                                          │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ shieldedInstanceConfig:                                                                         │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   enableSecureBoot: false                                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   enableVtpm: true                                                                              │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   enableIntegrityMonitoring: true                                                               │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ shieldedInstanceIntegrityPolicy:                                                                │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   updateAutoLearnPolicy: true                                                                   │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ confidentialInstanceConfig:                                                                     │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │   enableConfidentialCompute: false                                                              │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ fingerprint: C1buoQdRfn4=                                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ lastStartTimestamp: 2021-04-30T15:37:18.374-07:00                                               │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │ kind: compute#instance                                                                          │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│            │                                                                                                 │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────┴──────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">List Summary:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ google                                                                                                             │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ VmInstance         │ web-server                                                                                    │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 resource, 5 types, 1 provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc l -t VmInstance&quot; executed in 12s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p>The public address for this machine can be found at the field <code>networkInterfaces[0].accessConfigs[0].natIP</code>. Take anote, it will be used later to grab this IP address with the <code>gc output</code> command.</p></blockquote><p>Remember the service account created in the <code>init</code> phase?</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc l -t ServiceAccount</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Listing resources on 1 provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✓ google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Listing 1/1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ 2 ServiceAccount from google                                                                        │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────────────────┬───────────────────────────────────────────────────────────────────────┬──────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ Name                 │ Data                                                                  │ Our  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────────────────┼───────────────────────────────────────────────────────────────────────┼──────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ 571739547473-compute │ name: projects/vm-tuto1/serviceAccounts/571739547473-compute@develop… │ NO   │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ projectId: vm-tuto1                                                   │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ uniqueId: 100537252433166772587                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ email: 571739547473-compute@developer.gserviceaccount.com             │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ displayName: Compute Engine default service account                   │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ etag: MDEwMjE5MjA=                                                    │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ oauth2ClientId: 100537252433166772587                                 │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ iamPolicy:                                                            │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │   etag: ACAB                                                          │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │                                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────────────────┼───────────────────────────────────────────────────────────────────────┼──────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ grucloud             │ name: projects/vm-tuto1/serviceAccounts/grucloud@vm-tuto1.iam.gservi… │ NO   │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ projectId: vm-tuto1                                                   │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ uniqueId: 105136741134058242482                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ email: grucloud@vm-tuto1.iam.gserviceaccount.com                      │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ displayName: grucloud service account                                 │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ etag: MDEwMjE5MjA=                                                    │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ oauth2ClientId: 105136741134058242482                                 │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │ iamPolicy:                                                            │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │   etag: ACAB                                                          │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │                                                                       │      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└──────────────────────┴───────────────────────────────────────────────────────────────────────┴──────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">List Summary:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ google                                                                                             │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬───────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ ServiceAccount     │ 571739547473-compute                                                          │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│                    │ grucloud                                                                      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴───────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 resources, 1 type, 1 provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc l -t ServiceAccount&quot; executed in 5s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Notice here GCP has created a default service account for the compute engine.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="update">Update<a aria-hidden="true" class="hash-link" href="#update" title="Direct link to heading">​</a></h3><p>The machine type selected in the first place may be over-sized or under-sized. Let&#x27;s modify the <code>machineType</code> to <code>e2-micro</code>, and execute the <code>apply</code> or <code>plan</code> command:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc plan</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Querying resources on 1 provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✓ google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Listing 6/6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Querying</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ VmInstance 1/1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ 1 VmInstance from google                                                                     │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ ┌─────────────────────────────────────────────────────────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ UPDATE: name: web-server, id: 8693552609646106284                                       │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ ├─────────────────────────────────────────────────────────────────────────────────────────┤  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ Key: machineType                                                                        │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ ├────────────────────────────────────────────┬────────────────────────────────────────────┤  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ - f1-micro                                 │ + f2-micro                                 │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ └────────────────────────────────────────────┴────────────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└──────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌───────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ Plan summary for provider google                                                      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ DEPLOY RESOURCES                                                                      │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬──────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ VmInstance         │ web-server                                                       │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴──────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 resource to deploy on 1 provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc p&quot; executed in 6s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A difference between the live server and its desired state has been detected.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="output">Output<a aria-hidden="true" class="hash-link" href="#output" title="Direct link to heading">​</a></h3><p>In the previous step, the machine&#x27;s public IP address was discovered with <em>gcloud</em>, then it was manually cut and pasted to infer to ping command.</p><p>An alternative way to get the public ip address is with the <code>gc output</code> command. Specify a <code>type</code>, a <code>name</code> and a (nested) field:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc output -t VmInstance --name web-server --field &#x27;networkInterfaces[0].accessConfigs[0].natIP&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">35.198.52.62</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Seems to work as expected. Let&#x27;s combine in one shell command to ping the machine:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ping `gc output -t VmInstance --name web-server --field &#x27;networkInterfaces[0].accessConfigs[0].natIP&#x27;`</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="destroy">Destroy<a aria-hidden="true" class="hash-link" href="#destroy" title="Direct link to heading">​</a></h3><p>When the resources are no longer needed, delete them with the <code>destroy</code> command</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gc destroy</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Find Deletable resources on 1 provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✓ google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Listing 6/6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ 1 VmInstance from google                                                                     │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ ┌─────────────────────────────────────────────────────────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ DESTROY web-server                                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ ├─────────────────────────────────────────────────────────────────────────────────────────┤  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ id: 4915621396658280948                                                                 │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ creationTimestamp: 2021-05-01T16:41:16.034-07:00                                        │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ name: web-server                                                                        │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ tags:                                                                                   │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   fingerprint: 42WmSpB8rSM=                                                             │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ machineType: https://www.googleapis.com/compute/v1/projects/vm-tuto1/zones/southameric… │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ status: RUNNING                                                                         │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ zone: https://www.googleapis.com/compute/v1/projects/vm-tuto1/zones/southamerica-east1… │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ canIpForward: false                                                                     │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ networkInterfaces:                                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   - network: https://www.googleapis.com/compute/v1/projects/vm-tuto1/global/networks/d… │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     subnetwork: https://www.googleapis.com/compute/v1/projects/vm-tuto1/regions/southa… │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     networkIP: 10.158.0.6                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     name: nic0                                                                          │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     accessConfigs:                                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       - type: ONE_TO_ONE_NAT                                                            │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │         name: External NAT                                                              │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │         natIP: 35.198.52.62                                                             │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │         networkTier: PREMIUM                                                            │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │         kind: compute#accessConfig                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     fingerprint: GzKDoyPVgZI=                                                           │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     kind: compute#networkInterface                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ disks:                                                                                  │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   - type: PERSISTENT                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     mode: READ_WRITE                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     source: https://www.googleapis.com/compute/v1/projects/vm-tuto1/zones/southamerica… │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     deviceName: web-server-managed-by-gru                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     index: 0                                                                            │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     boot: true                                                                          │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     autoDelete: true                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     licenses:                                                                           │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       - &quot;https://www.googleapis.com/compute/v1/projects/ubuntu-os-cloud/global/license… │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     interface: SCSI                                                                     │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     guestOsFeatures:                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       - type: VIRTIO_SCSI_MULTIQUEUE                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       - type: SEV_CAPABLE                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       - type: UEFI_COMPATIBLE                                                           │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     diskSizeGb: 20                                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     kind: compute#attachedDisk                                                          │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ metadata:                                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   fingerprint: xJ9rqloLGTU=                                                             │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   items:                                                                                │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │     - key: enable-oslogin                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │       value: True                                                                       │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   kind: compute#metadata                                                                │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ selfLink: https://www.googleapis.com/compute/v1/projects/vm-tuto1/zones/southamerica-e… │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ scheduling:                                                                             │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   onHostMaintenance: MIGRATE                                                            │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   automaticRestart: true                                                                │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   preemptible: false                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ cpuPlatform: Intel Broadwell                                                            │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ labels:                                                                                 │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   managed-by: grucloud                                                                  │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   stage: dev                                                                            │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ labelFingerprint: 2XCNew8FA10=                                                          │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ startRestricted: false                                                                  │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ deletionProtection: false                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ reservationAffinity:                                                                    │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   consumeReservationType: ANY_RESERVATION                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ displayDevice:                                                                          │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   enableDisplay: false                                                                  │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ shieldedInstanceConfig:                                                                 │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   enableSecureBoot: false                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   enableVtpm: true                                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   enableIntegrityMonitoring: true                                                       │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ shieldedInstanceIntegrityPolicy:                                                        │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   updateAutoLearnPolicy: true                                                           │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ confidentialInstanceConfig:                                                             │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │   enableConfidentialCompute: false                                                      │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ fingerprint: Xh4hKPeAOUk=                                                               │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ lastStartTimestamp: 2021-05-01T16:41:25.313-07:00                                       │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │ kind: compute#instance                                                                  │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ │                                                                                         │  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ └─────────────────────────────────────────────────────────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└──────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">┌───────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ Destroy summary for provider google                                                   │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬──────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│ VmInstance         │ web-server                                                       │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴──────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">? Are you sure to destroy 1 resource, 1 type on 1 provider? › (y/N)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Destroying resources on 1 provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✓ google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Destroying</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ VmInstance 1/1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 resource destroyed, 1 type on 1 provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running OnDestroyedGlobal resources on 1 provider: google</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc destroy&quot; executed in 46s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If the <code>destroy</code> command is executed again, no resources should be destroyed.</p><p>Double-check with <code>gc list --our</code>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="next-steps">Next Steps<a aria-hidden="true" class="hash-link" href="#next-steps" title="Direct link to heading">​</a></h2><ul><li><p>Browse the various <a href="https://github.com/grucloud/grucloud/tree/main/examples/google" target="_blank" rel="noopener noreferrer">examples</a> which helps to find out how to use this software.</p></li><li><p>Available <a href="https://grucloud.com/docs/Introduction" target="_blank" rel="noopener noreferrer">GCP Resources</a></p></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objective" class="table-of-contents__link toc-highlight">Objective</a></li><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a><ul><li><a href="#gcp-account" class="table-of-contents__link toc-highlight">GCP Account</a></li><li><a href="#gcloud" class="table-of-contents__link toc-highlight">gcloud</a></li><li><a href="#initialise-gcloud" class="table-of-contents__link toc-highlight">Initialise gcloud</a></li><li><a href="#ssh-keys" class="table-of-contents__link toc-highlight">SSH keys</a></li><li><a href="#nodejs" class="table-of-contents__link toc-highlight">Node.js</a></li><li><a href="#grucloud-cli" class="table-of-contents__link toc-highlight">GruCloud CLI</a></li></ul></li><li><a href="#code-architecture" class="table-of-contents__link toc-highlight">Code Architecture</a><ul><li><a href="#packagejson" class="table-of-contents__link toc-highlight">package.json</a></li><li><a href="#configjs" class="table-of-contents__link toc-highlight">config.js</a></li><li><a href="#iacjs" class="table-of-contents__link toc-highlight">iac.js</a></li></ul></li><li><a href="#initialisation" class="table-of-contents__link toc-highlight">Initialisation</a><ul><li><a href="#project" class="table-of-contents__link toc-highlight">Project</a></li><li><a href="#api-services" class="table-of-contents__link toc-highlight">API Services</a></li><li><a href="#service-account" class="table-of-contents__link toc-highlight">Service Account</a></li><li><a href="#roles-binding" class="table-of-contents__link toc-highlight">Roles Binding</a></li><li><a href="#credential-file" class="table-of-contents__link toc-highlight">Credential file</a></li><li><a href="#info" class="table-of-contents__link toc-highlight">Info</a></li></ul></li><li><a href="#cli-workflow" class="table-of-contents__link toc-highlight">CLI Workflow</a><ul><li><a href="#plan" class="table-of-contents__link toc-highlight">Plan</a></li><li><a href="#deploy" class="table-of-contents__link toc-highlight">Deploy</a></li><li><a href="#list" class="table-of-contents__link toc-highlight">List</a></li><li><a href="#update" class="table-of-contents__link toc-highlight">Update</a></li><li><a href="#output" class="table-of-contents__link toc-highlight">Output</a></li><li><a href="#destroy" class="table-of-contents__link toc-highlight">Destroy</a></li></ul></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div><style data-emotion="css 1dszc5b">.css-1dszc5b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;}</style><div class="css-1dszc5b"><style data-emotion="css 1qkzzwm">.css-1qkzzwm{margin:20px;}</style><div class="css-1qkzzwm"><h4 class="footer__title">Community</h4><style data-emotion="css 1tzzd34">.css-1tzzd34{padding:0 30px 0 00px;list-style:none;}</style><ul class="css-1tzzd34"><li><a href="https://twitter.com/grucloud_iac" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li><a href="https://stackoverflow.com/questions/tagged/grucloud" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li><a href="https://discord.com/channels/803645280359546920/803645355606147082" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="css-1qkzzwm"><h4 class="footer__title">Documentation</h4><ul class="css-1tzzd34"><li><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/aws/AwsGettingStarted">AWS</a></li><li><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/google/GoogleGettingStarted">Google Cloud</a></li><li><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/azure/AzureGettingStarted">Microsoft Azure</a></li><li><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/k8s/K8sGettingStarted">Kubernetes</a></li></ul></div></div><style data-emotion="css gk60pb">.css-gk60pb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}.css-gk60pb >div{padding-right:30px;}</style><div class="css-gk60pb"><div>Copyright © 2022 GruCloud</div><a href="https://www.freeprivacypolicy.com/live/ada70892-c887-4a1d-8d0e-29801fe215b2">Privacy Policy</a></div></div></footer></div>
<script src="/assets/js/runtime~main.b7350002.js"></script>
<script src="/assets/js/main.78c43231.js"></script>
</body>
</html>